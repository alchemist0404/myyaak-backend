<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>GeoAR.js demo</title>
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
  </head>

<script>
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    const session_token = urlParams.get("session_token")
    const username = urlParams.get("username")
    const password = urlParams.get("password")
    if (session_token == null || username == null || password == null) {
        window.location.href = "./not-authrized.html"
    }
    
    window.onload = async () => {
        setInterval(async () => {
            navigator.geolocation.getCurrentPosition(successCallback, errorCallback)
        }, 10000)
    };

    async function successCallback(position) {
        const response = await fetch(`${serverURL}player/tasks/getPosition`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'User': JSON.stringify({token: { session_token }}),
                'LogIn': JSON.stringify({username, password})
            },
            body: JSON.stringify({lat: position.coords.latitude, lng: position.coords.longitude})
        })
    }

    function errorCallback(err) {
        console.log(`err`, err)
    }

</script>

  <body style="margin: 0; overflow: hidden;">
    <a-scene
      vr-mode-ui="enabled: false"
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false;"
    >
        <a-camera gps-camera-debug rotation-reader> </a-camera>
        <a-box 
            material="color: yellow"
            scale="5 5 5"
            gps-entity-place="latitude: 21.2252883; longitude: 72.8062864; "
        ></a-box>
        <a-box 
            material="color: red"
            scale="5 5 5"
            gps-entity-place="latitude: 21.2252283; longitude: 72.8062264;"
        ></a-box>
    </a-scene>
  </body>
</html>